<!DOCTYPE html>
<html lang="zh">
<head>
<meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Historical Timeline Viewer Pro</title>
    <link href="https://fonts.googleapis.com/css2?family=Crimson+Text:ital,wght@0,400;0,600;0,700;1,400&display=swap" rel="stylesheet">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/openseadragon/4.1.0/openseadragon.min.js"></script>
    <style>
        :root { 
            --axis-bg: #fff; 
            --text-color: #333;
            --line-color: #eee;
            --header-height: 80px;
            /* 定义全局字体变量 */
            --font-main: 'Crimson Text', "Times New Roman", serif;
        }
        
        body, html { 
            margin: 0; 
            padding: 0; 
            width: 100%; 
            height: 100%; 
            overflow: hidden; 
            background: #fff; 
            font-family: var(--font-main); 
        }
        
        #main-layout {
            display: grid;
            grid-template-columns: 90px 1fr; 
            grid-template-rows: var(--header-height) 35px 1fr 15vh; 
            width: 100vw;
            height: 100vh;
        }

        #header {
            grid-column: 1 / span 2;
            grid-row: 1;
            display: flex;
            align-items: baseline;
            padding: 20px 80px;
            border-bottom: 2px solid #000;
            background: #fff;
            z-index: 102;
        }

        #header h1 {
            margin: 0;
            font-family: var(--font-main);
            font-size: 38px;
            font-weight: 700;
            color: #4a2c1d;
            margin-right: 30px;
            letter-spacing: 0.5px;
        }

        #header p {
            margin: 0;
            font-size: 20px;
            color: #555;
        }

        #top-axis { 
            grid-column: 2; 
            background: var(--axis-bg); 
            position: relative; 
            z-index: 1000;
            overflow: visible; 
            display: flex;
            align-items: center; 
            border-bottom: 1px solid #ddd;
        }

        #left-axis { 
            grid-column: 1;
            grid-row: 3; 
            background: var(--axis-bg); 
            position: relative; 
            z-index: 100;
        }

        #corner { 
            grid-column: 1;
            grid-row: 2;
            background: #fff; 
            z-index: 101;
        }
        canvas {
            outline: none;
        }

        #viewer-container {
            grid-column: 2;
            grid-row: 3;
            background: #fff;
            position: relative;
            outline: none !important;
        }
        #viewer-container :focus {
            outline: none !important;
        }

        #bottom-nav-row {
            grid-column: 1 / span 2;
            grid-row: 4;
            background: #fff;
            border-top: 1px solid #333;
            display: flex; 
            justify-content: flex-start;
            align-items: center;
            padding-left: 10px;
        }

        .axis-label {
            position: absolute; 
            color: var(--text-color); 
            font-family: var(--font-main);
            white-space: nowrap;
            pointer-events: auto; 
            user-select: text;
        }
        
        .year-label { 
            right: 20px; 
            line-height: 1; 
            font-size: 19px;
        }
        
        .cat-label { 
            padding-left: 5px;
            border-left: 2px solid #333;
            font-size: 19px;
        }

        #navigator-box {
            height: 90% !important;
            aspect-ratio: 10701 / 2585;
            display: flex !important;
            justify-content: flex-start !important; 
            align-items: center;
            top: 5%;
            margin-left: 1% !important;
            background-color: #fff !important;
        }

        @media (max-width: 767px) {
            #main-layout {
                grid-template-rows: 100px 40px 1fr 0px; 
            }

            #header {
                flex-direction: column;
                align-items: flex-start;
                justify-content: center;
                padding: 10px 20px;
            }


            #header h1 {
                font-size: 24px;
                margin-bottom: 4px;
                font-weight: bold;
            }

            #header p {
                font-size: 14px;
                color: #666;
            }

            #left-axis { width: 45px; }
            .year-label { font-size: 14px; right: 8px; }
            .cat-label { font-size: 16px; }
        }
    </style>
</head>
<body>

<div id="main-layout">
    <div id="header">
        <h1>A Timetable of History</h1>
        <p>A Horizontal Linked History Page</p>
    </div>

    <div id="corner"></div>
    <div id="top-axis"></div>
    <div id="left-axis"></div>
    <div id="viewer-container"></div>
    <div id="bottom-nav-row">
        <div id="navigator-box"></div>
    </div>
</div>

<script>
    const isMobile = window.innerWidth < 768;
    console.log(window.innerWidth)
    const timelineData = {
         years: [
            { label: "1501", y: 0.02 },
            { label: "1502", y: 0.07 },
            { label: "1503", y: 0.115 },
            { label: "1504", y: 0.165 },
            { label: "1505", y: 0.21 }
        ],

        categories: [
            { label: "History / Politic", x: 0 },
            { label: "Literature / Theater", x: 0.165 },
            { label: "Visual Arts", x: 0.324 },
            { label: "Religion, Philosophy, Learning", x: 0.443 },
            { label: "Science/Technology/Growth", x: 0.583 },
            { label: "Music", x: 0.742 },
            { label: "Science", x: 0.858 }
        ]
    };

    const viewer = OpenSeadragon({
        id: "viewer-container",
        prefixUrl: "https://cdnjs.cloudflare.com/ajax/libs/openseadragon/4.1.0/images/",
        tileSources: 'THESIS_ouput.dzi',
        
        animationTime: 1.0,
        springStiffness: 12,
        visibilityRatio: 1.0,
        constrainDuringPan: true,
        minZoomImageRatio: isMobile ? 3.0 : 1.0,
        autoResize: true, 
        navigatorTileSources: {
            type: 'image',
            url: 'THESIS.png' 
        },
        gestureSettingsTouch: {
            pinchRotate: false,
            clickToZoom: true,
            dblClickToZoom: true,
            flickEnabled: true
        },
        showNavigationControl: false,
        showNavigator: !isMobile,
        navigatorId: isMobile ? null : "navigator-box",
        navigatorDisplayRegionColor: 'rgba(255, 0, 0, 0.5)',
        navigatorBorderColor: '#ff0000',                
        navigatorDisplayRegionBorderWidth: 2,            
    });

    const leftAxis = document.getElementById('left-axis');
    const topAxis = document.getElementById('top-axis');

    function initLabels() {
        leftAxis.innerHTML = '';
        topAxis.innerHTML = '';

        timelineData.years.forEach(d => {
            const div = document.createElement('div');
            div.className = 'axis-label year-label';
            div.innerText = d.label;
            leftAxis.appendChild(div);
            d.el = div;
        });

        timelineData.categories.forEach(d => {
            const div = document.createElement('div');
            div.className = 'axis-label cat-label';
            div.innerText = d.label;
            topAxis.appendChild(div);
            d.el = div;
        });
    }

    function updateAxis() {
        if (!viewer.viewport) return;
        const viewport = viewer.viewport;
        const bounds = viewport.getBounds();

        if (bounds.y < 0) {
            viewport.fitBounds(new OpenSeadragon.Rect(bounds.x, 0, bounds.width, bounds.height), false);
        }

        window.requestAnimationFrame(() => {
            timelineData.years.forEach(d => {
                if (d.el) { 
                    const imgPoint = new OpenSeadragon.Point(0, d.y);
                    const pixelPoint = viewport.pixelFromPoint(imgPoint, true);
                    d.el.style.transform = `translateY(${pixelPoint.y}px)`;
                    d.el.style.display = (pixelPoint.y < -30 || pixelPoint.y > leftAxis.offsetHeight) ? 'none' : 'block';
                }
            });

            timelineData.categories.forEach(d => {
                if (d.el) {
                    const imgPoint = new OpenSeadragon.Point(d.x, 0);
                    const pixelPoint = viewport.pixelFromPoint(imgPoint, true);
                    d.el.style.transform = `translateX(${pixelPoint.x}px)`;
                    d.el.style.display = (pixelPoint.x < -100 || pixelPoint.x > topAxis.offsetWidth + 10) ? 'none' : 'block';
                }
            });
        });
    }

    viewer.addHandler('open', () => {
        initLabels();
        
        const viewport = viewer.viewport;
        
        

        setTimeout(() => {
            viewer.viewport.setCanvasSize();
        }, 100);

        const containerAspect = viewport.getAspectRatio();
        viewport.fitBounds(new OpenSeadragon.Rect(0, 0, 1, 1 / containerAspect), true);
        
        updateAxis();
    });

    viewer.addHandler('animation', updateAxis);
    viewer.addHandler('canvas-scroll', updateAxis);
    viewer.addHandler('canvas-drag', updateAxis);
    viewer.addHandler('viewport-change', updateAxis);
    window.addEventListener('resize', updateAxis);

</script>
</body>
</html>